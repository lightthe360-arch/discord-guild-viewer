<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Discord Guilds Viewer</title>
</head>
<body>
<h2>Discord Guilds Viewer</h2>
<button id="login">Log in met Discord</button>
<ul id="guilds"></ul>

<script>
const CLIENT_ID = "1434624180904530083"; // Vul je Client ID hier in
const REDIRECT_URI = "https://docs.google.com/document/d/1a-ov9ifQ4L_6gfpQvO4cqjK68f0elX9l4cTc5kc77rk/edit?tab=t.0"; // Zelfde als in Discord Developer Portal
const SCOPES = "identify guilds";

// Haal access token uit URL hash
function getTokenFromHash() {
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  return params.get("access_token");
}

// Login button
document.getElementById("login").onclick = () => {
  const url = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${encodeURIComponent(SCOPES)}`;
  window.location.href = url;
};

// Als er een token is, haal guilds op
const token = getTokenFromHash();
if (token) {
  fetch("https://discord.com/api/users/@me/guilds", {
    headers: { Authorization: `Bearer ${token}` }
  })
  .then(res => res.json())
  .then(guilds => {
    const ul = document.getElementById("guilds");
    ul.innerHTML = "";
    guilds.forEach(g => {
      const li = document.createElement("li");
      li.textContent = `${g.name} (Owner: ${g.owner ? "ja" : "nee"})`;
      ul.appendChild(li);
    });
  })
  .catch(console.error);
}
</script>
</body>
</html>
